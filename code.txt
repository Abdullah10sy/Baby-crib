

#include <WiFi.h>
#include <HTTPClient.h>

// Wi-Fi and ThingSpeak configuration
const char* ssid = "Wokwi-GUEST";                   
const char* password = "";           
const char* thingSpeakKey = "VMUATLLXAMDZPL0T"; 

const int buzzerPin = 26;    // Pin for the buzzer
const int ledPin = 27;       // Pin for the LED
const int potPin = 34;       // Simulate baby cry detection with potentiometer

int cryThreshold = 500;      // Threshold for detecting a cry
int soundLevel = 0;          // Variable to store sound level

void setup() {
  Serial.begin(115200);
  pinMode(buzzerPin, OUTPUT);  
  pinMode(ledPin, OUTPUT);    
  
  // Connect to Wi-Fi
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.println("Connecting to WiFi...");
  }
  Serial.println("Connected to WiFi");
}

void loop() {
  soundLevel = analogRead(potPin); // Read sound level from potentiometer

  // Detect baby cry
  if (soundLevel > cryThreshold) {
    playBuzzer();  // Play sound on buzzer
    turnOnLED();   // Turn on LED
    sendToThingSpeak(soundLevel);  // Send data to ThingSpeak
  } else {
    noTone(buzzerPin); // Stop the buzzer
    turnOffLED();      // Turn off the LED
  }
  
  delay(2000); // Delay for stability
}

// Function to play sound on buzzer
void playBuzzer() {
  tone(buzzerPin, 440);  // Play sound
}

// Function to turn on LED
void turnOnLED() {
  digitalWrite(ledPin, HIGH);  // Turn on LED
}

// Function to turn off LED
void turnOffLED() {
  digitalWrite(ledPin, LOW);  // Turn off LED
}

// Function to send data to ThingSpeak
void sendToThingSpeak(int soundLevel) {
  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;
    String url = "https://api.thingspeak.com/update?api_key=" + String(thingSpeakKey) +
                 "&field1=" + String(soundLevel);
    http.begin(url); // Specify the URL
    int httpResponseCode = http.GET(); // Make the request
    if (httpResponseCode > 0) {
      Serial.println("Data sent: " + String(soundLevel)); // Confirm data sent
    }
    http.end(); // Free resources
  }
}
